
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/kendo/kendo.common.min.css" rel="stylesheet" />
<link href="~/Content/kendo/kendo.default.min.css" rel="stylesheet" />
<link href="~/assets/global/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/global/plugins/jquery-multi-select/css/multi-select.css" rel="stylesheet" type="text/css" />
<link href="~/assets/global/plugins/jstree/dist/themes/default/style.min.css" rel="stylesheet" type="text/css" />

<style>
    .fixle {
        height: 300px;
    }

    .ms-container {
        width: 90%;
    }

    .ms-optgroup-label {
        color: red;
    }

    .ms-container .ms-optgroup-label {
        color: red;
    }

    #grdlist .k-grid-content{
        min-height: 100px;
        min-width : 1000px;
    }
</style>

<!-- BEGIN PAGE HEADER-->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="fa fa-home"></i>
            <a href="index.html">Home</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="#">Pages</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="#">Todo</a>
        </li>
    </ul>
    <div class="page-toolbar">
        <div class="btn-group">
            <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true">
                Actions <i class="fa fa-angle-down"></i>
            </button>
            <ul class="dropdown-menu pull-right" role="menu">
                <li>
                    <a href="#">Action</a>
                </li>
                <li>
                    <a href="#">Another action</a>
                </li>
                <li>
                    <a href="#">Something else here</a>
                </li>
                <li class="divider">
                </li>
                <li>
                    <a href="#">Separated link</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- END PAGE HEADER-->
<!-- BEGIN PAGE CONTENT-->
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN TODO SIDEBAR -->
        <div class="todo-ui">
            <form action="#" class="form-horizontal form-bordered" id="frmSearchCampaign" method="POST">
                <div class="col-md-3">
                    <div class="portlet light">
                        <div class="portlet-title">
                            <div class="caption" data-toggle="collapse" data-target=".todo-project-list-content">
                                <span class="caption-subject font-green-sharp bold uppercase">CAMPAIGNS </span>
                                <span class="caption-helper visible-sm-inline-block visible-xs-inline-block">click to view project list</span>
                            </div>
                            <div class="actions">
                                <div class="btn-group">
                                    <a class="btn green-haze btn-circle btn-sm todo-projects-config" href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                        <i class="icon-settings"></i> &nbsp; <i class="fa fa-angle-down"></i>
                                    </a>
                                    <ul class="dropdown-menu pull-right">
                                        <li>
                                            <a href="#">
                                                <i class="i"></i> New Project
                                            </a>
                                        </li>
                                        <li class="divider">
                                        </li>
                                        <li>
                                            <a href="#">
                                                Pending <span class="badge badge-danger">
                                                    4
                                                </span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Completed <span class="badge badge-success">
                                                    12
                                                </span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Overdue <span class="badge badge-warning">
                                                    9
                                                </span>
                                            </a>
                                        </li>
                                        <li class="divider">
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="i"></i> Archived Projects
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="portlet-body">
                            <div class="scroller" style="height:737px" data-always-visible="1" data-rail-visible="1" data-rail-color="gray" data-handle-color="#a1b2bd">
                                <div id="tree_4" class="tree-demo"> </div>
                                <div align="right">
                                    <button type="button" class="btn btn-circle btn-sm green-haze" id="btnGetCampaign" onclick="seciliKampanyalariListele()">Search</button>
                                    <button class="btn btn-circle btn-sm btn-default" onclick="secimikaldir()" ><i class="fa fa-close"></i>Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
                <!-- END TODO SIDEBAR -->
                <!-- BEGIN TODO CONTENT -->
                <div class="todo-content col-md-9">
                    <div class="portlet light">
                        <!-- PROJECT HEAD -->
                        <div class="portlet-title">
                            <div class="container">
                                <!-- TASK TITLE -->
                                <div class="row">
                                    <div class="col-md-10">
                                        <input type="text" class="form-control todo-taskbody-tasktitle" placeholder="Search Description...">
                                    </div>
                                </div>
                                <br />

                                <div class="row">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control todo-taskbody-tags" placeholder="Tags..." value="Pending, Requested">
                                    </div>

                                    <div class="col-md-5">
                                        <div class="input-icon">
                                            <i class="fa fa-calendar"></i>
                                            <input type="text" class="form-control todo-taskbody-due" placeholder="Due Date...">
                                        </div>
                                    </div>
                                    <div class="actions col-md-2">
                                        <div class="btn-group">
                                            <a class="btn green-haze btn-circle btn-sm" href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                                MANAGE <i class="fa fa-angle-down"></i>
                                            </a>
                                            <ul class="dropdown-menu pull-right">
                                                <li>
                                                    <a href="#">
                                                        <i class="i"></i> New Task
                                                    </a>
                                                </li>
                                                <li class="divider">
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        Pending <span class="badge badge-danger">
                                                            4
                                                        </span>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        Completed <span class="badge badge-success">
                                                            12
                                                        </span>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        Overdue <span class="badge badge-warning">
                                                            9
                                                        </span>
                                                    </a>
                                                </li>
                                                <li class="divider">
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        <i class="i"></i> Delete Project
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- TASK TAGS -->
                            </div>
                            <br />
                        </div>
                        <!-- end PROJECT HEAD -->
                        <div class="portlet-body">
                            
                                
                                <div class="todo-tasklist-devider">
                                </div>
                                <div class="k-grid-content">
                                    @(Html.Kendo().Grid<Core.Dtos.StokKartAramaWebDTO>()
                                        .Name("grdlist")
                                        .Columns(columns =>
                                        {
                                            // columns.Bound(c => c.ID).Title(Dil.Getir("ID")).HeaderHtmlAttributes(new { @class = "" }).HtmlAttributes(new { @class = "" });
                                            columns.Bound(c => c.id).Title("islem").Width(100).ClientTemplate(
                                                "<a  href='javascript:'   onclick='StratejikPerformansDuzenle(this,  \"#=id#\")' class='btn btn-xs btn blue tooltips' title='" + "duzenle" + "'><i class='fa fa-pencil'></i></a>" +
                                                " <a href='javascript:'  onclick='StratejikPerformansSil(this,  \"#=id#\")'  class='btn btn-xs btn red tooltips' title='" + "sil" + "'><i class='fa fa-times'></i></a>").HeaderHtmlAttributes(new { @class = "col-md-2" }).HtmlAttributes(new { @class = "col-md-2" });
                                            columns.Bound(c => c.KucukResim).Title("KucukResim").Width(100).ClientTemplate("<img src='data:image/png;base64," + "@System.Convert.ToBase64String(\"#=KucukResim#\")' />");
                                            columns.Bound(c => c.Sirket_Kod).Title("Sirket_Kod").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Sirket_Kod) #"));
                                            columns.Bound(c => c.Marka).Title("Marka").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Marka) #"));
                                            columns.Bound(c => c.StokIsmi).Title("StokIsmi").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(StokIsmi) #"));
                                            columns.Bound(c => c.Ozellik).Title("Ozellik").Width(400).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Ozellik) #"));
                                            columns.Bound(c => c.Kampanyaid).Title("Kampanyaid").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Kampanyaid) #"));
                                            columns.Bound(c => c.StokAciklama).Title("StokAciklama").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(StokAciklama) #"));
                                            columns.Bound(c => c.TedarikciAdi).Title("TedarikciAdi").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(TedarikciAdi) #"));

                                            columns.Bound(c => c.Renk).Title("Renk").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Renk) #"));
                                            columns.Bound(c => c.Agirlik).Title("Agirlik").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(Agirlik) #"));
                                            columns.Bound(c => c.AlisFiyati).Title("AlisFiyati").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(AlisFiyati) #"));
                                            columns.Bound(c => c.AlisKDVOrani).Title("AlisKDVOrani").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(AlisKDVOrani) #"));
                                            columns.Bound(c => c.EkstraOzellik).Title("EkstraOzellik").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(EkstraOzellik) #"));
                                            columns.Bound(c => c.KonseptTanim).Title("KonseptTanim").Width(100).ClientTemplate(string.Format("{0}", "#= AciklamaFormatlayici(KonseptTanim) #"));

                                        })
                                        .Resizable(resize => resize.Columns(true))
                                        .Scrollable(s => s.Height(650))
                                        .DataSource(dataSource => dataSource
                                                                    .Ajax()
                                                                    .Read(read => read.Action("GetCampaignsFromSP", "Kampanyalar")))

                                    )
                                </div>
                            </div>
                    </div>
                </div>
                <!-- END TODO CONTENT -->
</div>
    </div>
    <!-- END PAGE CONTENT-->
</div>

<script src="~/assets/global/plugins/jstree/dist/jstree.min.js" type="text/javascript"></script>

<script type="text/javascript">

        function ustbirimlerisec() {
            secimikaldir();
            for (var i = 0; i < UstBirimler.length; i++) {
                $('#tree_4').jstree('select_node', (UstBirimler[i]));
            }

        };
        function altbirimlerisec() {
            secimikaldir();
            for (var i = 0; i < AltBirimler.length; i++) {
                $('#tree_4').jstree('select_node', (AltBirimler[i]));
            }
            //$(".birim").each(function (e, c) {
            //    $('#tree_4').jstree('select_node',($(this).attr('id')))
            //})
        };
        function secimikaldir() {
            $('#tree_4').jstree('deselect_all');
        };
        function tumbirimlerisec() {
            $('#tree_4').jstree("check_all");
        }

        var AciklamaFormatlayici = function (value) {
            return value;
        }

        ajaxGetSelectedItems();

        //getBirimIDCatagory();
        var to = false;
        $('#plugins4_q').keyup(function () {
            if (to) { clearTimeout(to); }
            to = setTimeout(function () {
                var v = $('#plugins4_q').val();
                $('#tree_4').jstree(true).search(v);
            }, 250);
        });

        var UstBirimler = [];
        var AltBirimler = [];
        function getBirimIDCatagory(id) {
            var log = $.post("/Kampanyalar/KampanyalariGetirInt", { parent: id }, function (data) {
                UstBirimler = data["UstBirim"];
                AltBirimler = data["AltBirim"];

            });
        }


        function ajaxGetSelectedItems() {
            $("#tree_4").jstree({
                "core": {
                    "themes": {
                        "responsive": false
                    },
                    // so that create works
                    "check_callback": true,
                    'data': {
                        'url': function (node) {
                            return "/Kampanyalar/KampanyalariGetir";
                        },
                        'data': function (node) {
                            return { 'parent': node.id };
                        }
                    }
                },
                "types": {
                    "default": {
                        "icon": "fa fa-folder icon-state-warning icon-lg"
                    },
                    "file": {
                        "icon": "fa fa-file icon-state-warning icon-lg"
                    }
                },
                "state": { "key": "demo3" },
                //"plugins": ["wholerow", "checkbox", "types"],
                "plugins": ["json_data", "checkbox", "ui", "themes", "search"]
            });
        };

        var seciliKampanyalariListele = function () {
            
            var selectedCampaigns = {};
            selectedCampaigns = $('#tree_4').jstree('get_selected');
            VeriGonder(selectedCampaigns);

            return false;
        };

        var VeriGonder = function (obj) {
            //App.blockUI();
            var formData = { selectedCampaigns: JSON.stringify(obj) };
            $.ajax({
                type: "POST",
                url: 'Kampanyalar/KampanyalarGeciciKaydet',
                data: formData,
                dataType: 'json',
                success: function (message) {
                    //HTTP redirect
                    //App.unblockUI();
                    switch (message.Type) {
                        case 1:
                            if (message.Success == true) {
                                toastr["success"]("basarili", message.Message);
                                RefresData();
                            }
                            break;
                        default:
                            if (message.Success == true) {
                                toastr["error"]("basarisiz", message.Message);
                            }
                    }
                },
                error: function () {
                    toastr["error"]("basarisiz", "basarisiz");
                    //App.unblockUI();
                }
            });

            RefresData();
        };

        var RefresData = function () {
            //App.blockUI();
            $.ajax({
                type: "POST",
                url: '/Kampanyalar/GetCampaignsFromSP',
                dataType: 'json',
                success: function (messsage) {
                    $('#grdlist').data('kendoGrid').dataSource.read();
                    $('#grdlist').data('kendoGrid').refresh();
                    //App.unblockUI();
                },
                error: function () {

                }
            });
        };

</script>
